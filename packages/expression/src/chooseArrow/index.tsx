import { useChoose } from '@xeditor/plugin-choose';
import * as React from 'react';
import './style.styl';

interface IProps {
  flag: string;
  className?: string;
  onChoose: (compState: Editor.IFeatureState | null) => void;
}

export function ChooseArrow(props: IProps) {
  const [isChoosing, setChoose] = React.useState(false);
  const choose = useChoose();

  React.useEffect(() => {
    choose.subscribeChoose(props.flag, (state: Editor.IFeatureState | null) => {
      props.onChoose(state);
      setChoose(false);
    });
    return () => choose.unSubscribeChoose(props.flag);
  });

  const handleArrowClick = React.useCallback(() => {
    if (isChoosing) {
      choose.cancelChooseAction();
      choose.unSubscribeChoose(props.flag);
    } else {
      choose.emitChooseAction(props.flag);
    }
    setChoose(!isChoosing);
  }, [isChoosing]);

  return (
    <svg
      viewBox='0 0 1024 1024'
      onClick={handleArrowClick}
      className={`evt-icon-arrow ${isChoosing ? 'evt-choose-arrow' : ''} ${typeof props.className === 'undefined' ? '' : props.className}`} >
      <path d='M511.90178506 399.12091237c-62.30424914 0-112.97323779 50.66821618-112.9732378 112.9732378 0 62.30810767 50.66898788 112.97709632 112.9732378 112.97709632 62.30887937 0 112.97709632-50.66898788 112.97709554-112.97709632 0-62.30424914-50.66898788-112.97323779-112.97709555-112.9732378z m0 169.46410069c-31.14980908 0-56.48623266-25.33642358-56.48623343-56.49086289 0-31.14980908 25.33642358-56.48777607 56.48623342-56.48777606 31.15521177 0 56.49086288 25.33796699 56.4908629 56.48777606-0.0007717 31.15444007-25.33642358 56.49086288-56.49086289 56.49086289z m0 0' p-id='4129'></path>
      <path d='M879.06962971 483.85296271h-0.81879774C864.43854122 303.60172479 720.39729726 159.55584983 540.14760197 145.74819007v-0.81879774c0-15.59265449-12.65316319-28.24581768-28.24581691-28.24581767-15.58802426 0-28.24118745 12.65316319-28.24118747 28.24581767v0.81879774C303.4101306 159.55584983 159.36348471 303.60172479 145.55659589 483.85296271H144.73779816c-15.59265449 0-28.24581768 12.65316319-28.24581691 28.24118747 0 15.58956768 12.65316319 28.24581768 28.24581691 28.24581768h0.81879773C159.36348471 720.59043408 303.4101306 864.63090711 483.66059759 878.44396879v0.81879773c0 15.61580638 12.65316319 28.24581768 28.24118747 28.24581768 15.59265449 0 28.24581768-12.6292396 28.24581691-28.24581768v-0.81879772C720.39729726 864.63090711 864.43854122 720.59043408 878.25160369 540.33996786h0.81879772c15.61812149 0 28.24581768-12.6554783 28.24581768-28.24581768-0.0007717-15.58802426-12.62769619-28.24118745-28.24658938-28.24118747zM540.14760197 821.95773613v-55.66820664c0-15.61734979-12.65316319-28.24504598-28.24581691-28.24504597-15.58802426 0-28.24118745 12.62692448-28.24118747 28.24504597v55.66820664c-149.12612414-13.50205813-268.12034114-132.52174135-281.61776827-281.61776827h55.66743493c15.5918828 0 28.24581768-12.6554783 28.24581768-28.24581768 0-15.58802426-12.65393489-28.24118745-28.24581768-28.24118747h-55.66743493c13.49742791-149.12689585 132.49164413-268.12111283 281.61776827-281.61776827v55.66743493c0 15.59265449 12.65316319 28.24504598 28.24118746 28.24504596 15.59265449 0 28.24581768-12.65316319 28.24581692-28.24504596v-55.66743493c149.09602692 13.49742791 268.11571092 132.49164413 281.61776905 281.61776827h-55.66820741c-15.61812149 0-28.24581768 12.65316319-28.24581691 28.24118747 0 15.58956768 12.62692448 28.24581768 28.24581691 28.24581768h55.66820741c-13.50282983 149.09602692-132.52174135 268.11493922-281.61776905 281.61776827z m0 0' p-id='4130' >
      </path>
    </svg>
  );
}
